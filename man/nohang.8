.\" Automatically generated by Pandoc 3.1.11.1
.\"
.TH "NOHANG" "8" "" "" "Linux System Administrator\[aq]s Manual"
.SH NAME
nohang \- A sophisticated low memory handler
.SH SYNOPSIS
\f[B]nohang\f[R] [\f[B]OPTION\f[R]]\&...
.SH DESCRIPTION
\f[B]nohang\f[R] is a highly configurable daemon for Linux which can
correctly prevent out of memory (OOM) and maintain system responsiveness
under low memory conditions.
.SH REQUIREMENTS
.SS For basic usage:
.IP \[bu] 2
Linux (>= 3.14, since MemAvailable appeared in \f[B]/proc/meminfo\f[R])
.IP \[bu] 2
Python (>= 3.3)
.SS To respond to PSI metrics (optional):
.IP \[bu] 2
Linux (>= 4.20) with \f[B]CONFIG_PSI=y\f[R]
.SS To show GUI notifications (optional):
.IP \[bu] 2
Notification server (most desktop environments use their own
implementations).
.IP \[bu] 2
\f[B]libnotify\f[R] (Arch Linux, Fedora, openSUSE) or
\f[B]libnotify\-bin\f[R] (Debian GNU/Linux, Ubuntu).
.IP \[bu] 2
sudo if \f[B]nohang\f[R] started with UID=0.
.SH COMMAND\-LINE OPTIONS
.SS \-h, \-\-help
Show this help message and exit.
.SS \-v, \-\-version
Show version of installed package and exit.
.SS \-m, \-\-memload
Consume memory until 40 MiB (MemAvailable + SwapFree) remain free, then
terminate the process.
.SS \-c CONFIG, \-\-config CONFIG
Path to the config file.
This should only be used with one of the following options:
\f[B]\-\-monitor\f[R], \f[B]\-\-tasks\f[R], \f[B]\-\-check\f[R].
.SS \-\-check
Check and show the configuration and exit.
This should only be used with the \f[B]\-c\f[R]/\f[B]\-\-config\f[R]
option.
.SS \-\-monitor
Start monitoring.
This should only be used with the \f[B]\-c\f[R]/\f[B]\-\-config\f[R]
option.
.SS \-\-tasks
Show tasks state and exit.
This should only be used with the \f[B]\-c\f[R]/\f[B]\-\-config\f[R]
option.
.SH FILES
.SS :SYSCONFDIR:/nohang/nohang.conf
Vanilla \f[B]nohang\f[R] configuration file.
.SS :SYSCONFDIR:/nohang/nohang\-desktop.conf
Configuration file with settings optimized for desktop usage.
.SS :DATADIR:/nohang/nohang.conf
File with \f[I]default\f[R] \f[B]nohang.conf\f[R] values.
.SS :DATADIR:/nohang/nohang\-desktop.conf
File with \f[I]default\f[R] \f[B]nohang\-desktop.conf\f[R] values.
.SS /var/log/nohang/nohang.log
Optional log file that stores entries if \f[B]separate_log=True\f[R].
.SS /etc/logrotate.d/nohang
Logrotate config file controlling rotation in
\f[B]/var/log/nohang/\f[R].
.SH nohang.conf vs nohang\-desktop.conf
.IP \[bu] 2
\f[B]nohang.conf\f[R] provides vanilla default settings without PSI
checking, badness correction, or GUI notifications enabled.
.IP \[bu] 2
\f[B]nohang\-desktop.conf\f[R] provides default settings optimized for
desktop usage.
.SH KNOWN PROBLEMS
Problems can occur with out\-of\-tree kernels and modules:
.IP \[bu] 2
The ZFS ARC cache is memory\-reclaimable, like the Linux buffer cache;
however, unlike the buffer cache, it currently does not count to
MemAvailable [1].
See also [2] and [3].
.IP \[bu] 2
Linux kernels without \f[B]CONFIG_CGROUP_CPUACCT=y\f[R] (linux\-ck, for
example) provide incorrect PSI metrics, see this thread [4].
.SH HOW TO CONFIGURE
The program can be configured by editing the config file; the
configuration includes the following sections:
.IP \[bu] 2
Memory levels to consider an OOM threat
.IP \[bu] 2
Response on PSI memory metrics
.IP \[bu] 2
Frequency of checking memory availability (and CPU usage)
.IP \[bu] 2
Prevention of killing innocent victims
.IP \[bu] 2
Modify process badness by matching their names, cmdlines, and UIDs with
regular expressions
.IP \[bu] 2
The execution of a specific command or sending any signal instead of
SIGTERM
.IP \[bu] 2
GUI notifications:
.RS 2
.IP \[bu] 2
notifications of corrective actions taken
.IP \[bu] 2
low memory warnings
.RE
.IP \[bu] 2
Verbosity
.IP \[bu] 2
Misc
.PP
Read the parameter descriptions, edit the values, and restart the daemon
to apply changes.
.SH CHECK CONFIG
Check the config for errors:
.IP
.EX
$ nohang \-\-check \-\-config /path/to/config
.EE
.SH HOW TO TEST
The safest way is to run \f[B]nohang \-\-memload\f[R].
This causes memory consumption; the process will exit before OOM occurs.
Another method is running \f[B]tail /dev/zero\f[R]; this causes fast
memory comsumption and OOM at the end.
If testing occurs while nohang is running, these processes should be
terminated before OOM occurs.
.SH LOGGING
To view the latest entries in the log (for systemd users):
.IP
.EX
$ sudo journalctl \-eu nohang.service
.EE
.PP
or
.IP
.EX
$ sudo journalctl \-eu nohang\-desktop.service
.EE
.PP
You can also enable \f[B]separate_log\f[R] in the config to log to
\f[B]/var/log/nohang/nohang.log\f[R].
.SH SIGNALS
Sending \f[B]SIGTERM\f[R], \f[B]SIGINT\f[R], \f[B]SIGQUIT\f[R], or
\f[B]SIGHUP\f[R] signals to \f[B]nohang\f[R] causes it to display
corrective action stats and exit.
.SH REPORTING BUGS
Please direct questions and bug reports to \c
.UR https://github.com/hakavlad/nohang/issues
.UE \c
\&.
.SH AUTHOR
Alexey Avramov \c
.MT hakavlad@gmail.com
.ME \c
\&.
.SH HOMEPAGE
\c
.UR https://github.com/hakavlad/nohang
.UE \c
.SH SEE ALSO
oom\-sort(1), psi\-top(1), psi2log(1)
.SH NOTES
.IP "1." 3
https://github.com/openzfs/zfs/issues/10255
.IP "2." 3
https://github.com/rfjakob/earlyoom/pull/191#issuecomment\-622314296
.IP "3." 3
https://github.com/hakavlad/nohang/issues/89
.IP "4." 3
https://github.com/hakavlad/nohang/issues/25#issuecomment\-521390412
